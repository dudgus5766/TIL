# Redux-saga

## ë¯¸ë“¤ì›¨ì–´

![](https://images.velog.io/images/rhfovk/post/82160492-20d7-4ae7-8c4e-553220422af7/image.png)
ë¯¸ë“¤ì›¨ì–´ëŠ”, ì•¡ì…˜ì´ dispatch ë˜ì–´ì„œ ë¦¬ë“€ì„œì—ì„œ ì´ë¥¼ ì²˜ë¦¬í•˜ê¸° ì „ì— ì‚¬ì „ì— ì§€ì •ëœ ì‘ì—…ë“¤ì„ ì„¤ì •í•œë‹¤.

ì•¡ì…˜ê³¼ ë¦¬ë“€ì„œ ì‚¬ì´ì˜ ì¤‘ê°„ìë¼ê³  ì´í•´í•˜ë©´ ì‰½ë‹¤! ì•¡ì…˜ì„ ê²€ì¦í•˜ê±°ë‚˜ **í•„í„°ë§, ëª¨ë‹ˆí„°ë§, ì™¸ë¶€ APIì™€ì˜ ì—°ë™, ë¹„ë™ê¸° ì²˜ë¦¬** ë“±ì„ ì¶”ê°€ì ìœ¼ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.

---

## Redux-saga

ê·¸ë˜ì„œ ë¯¸ë“¤ì›¨ì–´ ì¤‘ `saga`ì— ëŒ€í•´ ì•Œì•„ë³´ì!

![](https://images.velog.io/images/rhfovk/post/b27e6cc0-553e-4ec0-80c4-256c13f821a0/image.png)

redux-sagaëŠ” **ë¹„ë™ê¸°ì **ìœ¼ë¡œ dispatchë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê³ , ë‚´ë¶€ ë©”ì†Œë“œë¥¼ í™œìš©í•˜ì—¬ ì‚¬ìš©ìì˜ ì—¬ëŸ¬ë²ˆ requset ì¤‘ ê°€ì¥ ìµœê·¼ or ê°€ì¥ ë§ˆì§€ë§‰ requestì˜ responseë§Œ ë°›ì•„ì˜¤ë„ë¡ í•˜ëŠ” ê¸°ëŠ¥ë„ ìˆë‹¤.

### Layer êµ¬ì„±

![](https://images.velog.io/images/rhfovk/post/13137d95-9130-4c8c-920f-e1d58b22a84d/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-11-05%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%207.36.57.png)

`view layer`ì—ëŠ” ë³´í¸ì ìœ¼ë¡œ **ë¦¬ì•¡íŠ¸**ê°€,
`state layer`ì—ëŠ” **ë¦¬ë•ìŠ¤**,
`side effect layer`ì—ëŠ” **ë¦¬ë•ìŠ¤ ì‚¬ê°€**ë¥¼ ì“°ì¸ë‹¤.

> **Side Effect?**
> ì—¬ê¸°ì„œ ë§í•˜ëŠ” ì‚¬ì´ë“œ ì´í™íŠ¸ë€ ì™¸ë¶€ì„¸ê³„ì— ì˜í–¥ì„ ì£¼ê±°ë‚˜ ë°›ëŠ” ê²ƒ.
> ì™¸ë¶€ë¡œë¶€í„° ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ì„œ ê²°ê³¼ê°’ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ë³´ì—¬ ì£¼ê±°ë‚˜ ë˜ëŠ” ê¸°ì¡´ ë°ì´í„°ì™€ ë¹„êµë¥¼ í•´ì„œ ì—…ë°ì´íŠ¸ ìœ ë¬´ë¥¼ íŒë‹¨í•´ì•¼ í•˜ëŠ” ìƒí™© ë“±ì´ ìˆë‹¤.
> ì´ëŸ´ë•Œ Redux-Sagaë¥¼ ì‚¬ìš©í•˜ê²Œ ëœë‹¤.

### Generator

ì¼ë‹¨ sagaë¥¼ ì´í•´í•˜ê¸° ìœ„í•´ì„œëŠ” ê·¸ ì „ì— **Generator ë¬¸ë²•**ì„ ì•Œì•„ì•¼ í•œë‹¤.

ì œë„ˆë ˆì´í„° í•¨ìˆ˜ë¥¼ ë§Œë“¤ ë•Œì—ëŠ”Â `function*`Â ì´ë¼ëŠ” í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•œë‹¤.
ì œë„ˆë ˆì´í„° í•¨ìˆ˜ë¥¼ í˜¸ì¶œí–ˆì„ë•ŒëŠ” í•œ ê°ì²´ê°€ ë°˜í™˜ë˜ëŠ”ë°, ì´ë¥¼ **ì œë„ˆë ˆì´í„°**ë¼ê³  ë¶€ë¥¸ë‹¤.

```js
function* getNumbers() {
  console.log("ì²«ë²ˆì§¸");
  yield 10;
  console.log("ë‘ë²ˆì§¸");
  yield 20;
  console.log("ì„¸ë²ˆì§¸");
  return "finished";
}
const gen = f1();
```

ì´ ì œë„ˆë ˆì´í„° ê°ì²´ì—ëŠ” `next` ë¼ëŠ” í•¨ìˆ˜ê°€ ìˆë‹¤. ì´ê²ƒì„ ì´ 3ë²ˆ í˜¸ì¶œí•´ë³´ì!
ê·¸ëŸ¬ë©´ `yield` ë¼ê³  í‘œì‹œë˜ì–´ìˆëŠ” ë¶€ë¶„ì„ ê¸°ì¤€ìœ¼ë¡œ êµ¬ê°„ì´ ë‚˜ëˆ ì§€ê³ , í•œë²ˆ í˜¸ì¶œí•  ë•Œë§ˆë‹¤ `yield` ê°€ ìˆëŠ” êµ¬ê°„ê¹Œì§€ ì‹¤í–‰ì´ ëœë‹¤. ë°˜í™˜ ê°ì²´ëŠ” `yield` ì˜¤ë¥¸ìª½ ê°’ì´ ë°˜í™˜ë˜ê³ , done ì´ë¼ëŠ” ì†ì„±ì— f1 í•¨ìˆ˜ê°€ ì „ë¶€ ì™„ë£Œë˜ì—ˆëŠ”ì§€ ìƒíƒœì—¬ë¶€ê°€ boolean íƒ€ì…ìœ¼ë¡œ ë¦¬í„´ë©ë‹ˆë‹¤.

```js
console.log(gen.next());
/*
  ì‹¤í–‰êµ¬ê°„
  console.log('ì²«ë²ˆì§¸');
  yield 10;

  ë°˜í™˜ê°ì²´
  { value: 10, done: false }
*/

console.log(gen.next());
/*
  ì‹¤í–‰êµ¬ê°„
  console.log('ë‘ë²ˆì§¸');
  yield 20;

  ë°˜í™˜ê°ì²´
  { value: 20, done: false }
*/

console.log(gen.next());
/*
  ì‹¤í–‰êµ¬ê°„
  console.log('ì„¸ë²ˆì§¸');
  yield 30;

  ë°˜í™˜ê°ì²´
  { value: 'finished', done: true }
*/
```

### Effect

EffectëŠ” **ë¯¸ë“¤ì›¨ì–´ì— ì˜í•´ ìˆ˜í–‰ë˜ëŠ” ëª…ë ¹ì„ ë‹´ê³  ìˆëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°ì²´**ë¼ê³  ìƒê°í•˜ë©´ ëœë‹¤.

Effectì—ëŠ” ì—¬ëŸ¬ê°€ì§€ ìœ í‹¸í•¨ìˆ˜ë“¤ì´ ìˆë‹¤. ë¦¬ë•ìŠ¤ ì‚¬ê°€ì—ì„œëŠ” ì•„ë˜ì™€ ê°™ì´ `put`, `call`, `all` ì´ë¼ëŠ” ë¶€ìˆ˜íš¨ê³¼ í•¨ìˆ˜ë¥¼ ì£¼ë¡œ ì‚¬ìš©í•œë‹¤.

> `put` ì´ë¼ëŠ” ê²ƒì€ ë¦¬ë•ìŠ¤ ì•¡ì…˜ì„ ë°œìƒì‹œí‚¤ëŠ” ê²ƒ.
> `call` ì€ ì„œë²„ì˜ API í˜¸ì¶œ í•¨ìˆ˜ê°€ ì¸ìˆ˜ë¡œ ë“¤ì–´ê°„ë‹¤.(ì˜ˆì™¸ë„ ìˆìŒ)

ì—¬ê¸°ì—ì„œëŠ” REQUEST_LIKE ì•¡ì…˜ì´ ì‹¤í–‰ë  ë•Œë§ˆë‹¤ fetchData ì•„ë˜ì— ë“¤ì–´ìˆëŠ” ë¡œì§ì´ ì‹¤í–‰ì´ ë˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì—¬ê¸°ì„œ takeLeading ì˜ ì—­í• ì€ ìš°ë¦¬ê°€ ë§Œì•½ ì¢‹ì•„ìš”ë¥¼ í•œë²ˆ ëˆŒë €ì„ë•Œ, fetchData í•¨ìˆ˜ê°€ ì•„ì§ ì§„í–‰ì¤‘ì— ìˆë‹¤ë©´, ê·¸ ì‚¬ì´ì— ë“¤ì–´ì˜¨ ì•¡ì…˜ì€ ë¬´ì‹œí•˜ê³  ì²˜ìŒì— ë“¤ì–´ì˜¨ ì•¡ì…˜ì„ ìš°ì„ ìœ¼ë¡œ ì²˜ë¦¬í•˜ë„ë¡ ê´€ë¦¬í•´ì¤ë‹ˆë‹¤.

ë°˜ëŒ€ì˜ ê¸°ëŠ¥ì„ í•˜ëŠ” ê²ƒì€ takeLatest ë¼ëŠ” í•¨ìˆ˜ê°€ ìˆìŠµë‹ˆë‹¤. ì´ê²ƒì€ ì²˜ìŒì— ìš”ì²­í–ˆë˜ ë¶€ë¶„ì€ ë¬´ì‹œí•˜ê³  ìµœê·¼ì— ìš”ì²­í•œ ì•¡ì…˜ì„ ìš°ì„ ì ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì²˜ë¦¬ì¤‘ì¸ ê²ƒì„ ì·¨ì†Œì‹œí‚¤ê³  ìƒˆë¡œ ë“¤ì–´ì˜¨ ê²ƒì„ ë‹¤ì‹œ ì²˜ë¦¬í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

---

## ë‚ ì”¨ APIë¥¼ ì‚¬ìš©í•œ ë¦¬ë•ìŠ¤ ì‚¬ê°€ ì‹¤ìŠµ

í”Œëœì¦ˆ ì»¤í”¼ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë¦¬ë•ìŠ¤ ì‚¬ê°€ë¥¼ ìµíˆê¸° ìœ„í•´ ì˜¤í”ˆ apiì¸ ë‚ ì”¨ apië¥¼ ì‚¬ìš©í•´ ì„œìš¸ì˜ ë‚ ì”¨ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì•±ì„ ë§Œë“œëŠ” ì‹¤ìŠµì„ ì§„í–‰í–ˆë‹¤.

**components/Weather.js **

```js
import { call, put, take } from "redux-saga/effects";
import { eventChannel, END } from "redux-saga";

// ì´ë²¤íŠ¸ ì±„ë„ì„ ë§Œë“¤ì–´ setinterval í•¨ìˆ˜ë¥¼ í†µí•´ 1ì´ˆ ë§ˆë‹¤ api í˜¸ì¶œì„ í•˜ëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“¤ì—ˆë‹¤.
// 10ì´ˆë¥¼ ì œí•œìœ¼ë¡œ ë‘¬ì„œ 10ì´ˆ ë™ì•ˆ 1ì´ˆì”© api í˜¸ì¶œì„ í•œë‹¤.
function countdown(secs) {
  return eventChannel((emitter) => {
    const iv = setInterval(async () => {
      secs -= 1;
      if (secs > 0) {
        const result = await axios.get(
          "http://api.openweathermap.org/data/2.5/weather?q=Seoul&units=metric&APPID=e75a0a68adc50371c5898d8d43931062"
        );
        emitter(result);
      } else {
        emitter(END);
      }
    }, 1000);
    return () => {
      clearInterval(iv);
    };
  });
}

// ì‚¬ê°€ì—ì„œëŠ” channelë¡œ countdowní•¨ìˆ˜ì˜ ê²°ê³¼ê°’ì„ ë°›ëŠ”ë‹¤.
// yieldë¡œ channelì„ ë°›ì•„ì„œ resultì— ê°’ì„ ë„£ê³ 
// yieldë¡œ ì•¡ì…˜ì„ putí•œë‹¤.
export function* weatherSaga() {
  const channel = yield call(countdown, 10);

  while (true) {
    const { data } = yield take(channel);
    const result = {
      area: data.name,
      lowTemp: Math.floor(data.main.temp_min),
      highTemp: Math.floor(data.main.temp_max),
    };
    yield put(getWeatherSuccess(result));
  }
}
```

<br>

### ì¶œì²˜ ğŸ“š

---

https://mskims.github.io/redux-saga-in-korean/
https://velopert.com/3401
ë‚ ì”¨api : https://www.apistore.co.kr/generalApi/generalApiView.do?general_service_seq=84
